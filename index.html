<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="virt DOM : virt DOM for the browser and node.js">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>virt DOM</title>

      <script async="" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js" type="text/javascript" charset="utf-8"></script>
      <script async="" src="javascripts/main.js" type="text/javascript" charset="utf-8"></script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">VIRT DOM</h1>
          <div id="npm_install">
            <p>npm install @nathanfaucett/virt --save</p>
            <p>npm install @nathanfaucett/virt-dom --save</p>
          </div>
          <p>&nbsp;</p>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

      <p>
        <a href="https://github.com/nathanfaucett/js-virt" target="_blank">virt</a>
        is a tool for creating interactive UIs where you use abstract views for each state in your
        application, and virt will find the differences and create a Transaction.
        virt was created after reading facebook's <a href="https://github.com/facebook/react" target="_blank">React</a>
        source code. The difference is <a href="https://github.com/nathanfaucett/js-virt" target="_blank">virt</a>
        creates JSON Transactions that an adapter like <a href="https://github.com/nathanfaucett/js-virt-dom" target="_blank">virt-dom</a>
        uses to render to some native view system, in <a href="https://github.com/nathanfaucett/js-virt-dom" target="_blank">virt-dom's</a>
        case the DOM.
      </p>
      <p>
        <a href="https://github.com/nathanfaucett/js-virt-dom" target="_blank">virt-dom</a>
        provides adapters to render <a href="https://github.com/nathanfaucett/js-virt" target="_blank">virt</a>
        changes to the DOM over a WebSocket, a WebWorker or from the main javascript thread.
        Examples of all three are below.
      </p>

          <h3>Real World Example</h3>
          <p>
            Full site example here <a href="http://bomontfii.com" target="_blank">http://bomontfii.com</a>.
            github <a href="https://github.com/nathanfaucett/js-bomont_flooring" target="_blank">repo</a> for virt views and application logic.
            github <a href="https://github.com/nathanfaucett/js-bomont_flooring-dom" target="_blank">repo</a> for building and starting application.
          </p>

          <h3>Some technical examples</h3>
          <ul>
            <li><a href="http://nathanfaucett.github.io/js-virt-dom/examples/components" target="_blank">Components</a></li>
            <li><a href="http://nathanfaucett.github.io/js-virt-dom/examples/input_events" target="_blank">Input Events</a></li>
            <li><a href="http://nathanfaucett.github.io/js-virt-dom/examples/replace" target="_blank">Replace</a></li>
            <li><a href="http://nathanfaucett.github.io/js-virt-dom/examples/simple" target="_blank">Simple Example</a></li>
            <li><a href="http://nathanfaucett.github.io/js-virt-dom/examples/worker_form" target="_blank">Components with Workers</a></li>
            <li><a href="http://nathanfaucett.github.io/js-virt-dom/examples/workers" target="_blank">Simple Example with Workers</a></li>
          </ul>

          <h1>Simple Example Usage</h1>

          <p>The best way to use virt is to create custom components that inherit from the virt.Component class.</p>

          <div class="ace-editor code javascript">var virt = require("@nathanfaucett/virt"),
    virtDOM = require("@nathanfaucett/virt-dom");


function List(props, children, context) {
    virt.Component.call(this, props, children, context);

    this.state = {
        items: [
            {id: 0, text: "Item 1"},
            {id: 1, text: "Item 2"}
        ]
    };
}
// same as
// List.prototype = Object.create(virt.Component.prototype);
// List.prototype.displayName = "List";
virt.Component.extend(List, "List");

List.prototype.onClick = function(id) {
    var _this = this;

    this.state.items.forEach(function(value, index, array) {
        if (value.id === id) {
            array.splice(index, 1);
            _this.setState({
                items: array
            });
            return false;
        }
    });
};

List.prototype.render = function() {
    var _this = this;

    return (
        virt.createView("ul", this.state.items.map(function(item) {
            return virt.createView(Item, {
                key: item.id,
                onClick: function onClick() {
                    _this.onClick(item.id);
                },
                text: item.text
            });
        }))
    );
};

function Item(props, children, context) {
    virt.Component.call(this, props, children, context);
}
virt.Component.extend(Item, "Item");

Item.prototype.render = function() {
    return (
        virt.createView("li", {
            onClick: this.props.onClick
        }, this.props.text)
    );
};


virtDOM.render(virt.createView(List), document.getElementById("app"));
</div>

<h1>Messeger</h1>

<p>
  A <a href="https://github.com/nathanfaucett/js-messenger" target="_blank">messeger</a>
  is how all data is sent and received between the views and the renderer. This is used
  internally to fix inconsistencies in native DOM elements.
  <a href="https://github.com/nathanfaucett/js-virt-dom/tree/master/src/nativeDOM" target="_blank">Native DOM Elements</a>
 </p>

<div class="ace-editor code javascript">var virt = require("@nathanfaucett/virt");


function HelloWorld(props, children, context) {
    virt.Component.call(this, props, children, context);
}
virt.Component.extend(HelloWorld, "example.HelloWorld");

HelloWorld.prototype.componentDidMount = function(id) {
    this.emitMessage("example.HelloWorld.mount", {
            id: this.getInternalId()
        },
        // optional callback
        function onHandled(error, data) {
            if (error) {
                // handle error
            } else {
                // handle any data send from the handler
            }
        }
    );
};

HelloWorld.prototype.render = function() {
    return virt.createView("div");
};


var virtDOM = require("@nathanfaucett/virt-dom");


virtDOM.addNativeHandler(
    "example.HelloWorld.mount",
    function(data, doneCallback) {
        var id = data.id,
            node = findDOMNode(id);

        if (node) {
            node.innerHTML = "<p>Hello, world!<p>";

            // optionally send data back
            // doneCallback(undefined, data);
            doneCallback();
        } else {
            doneCallback(new Error("No DOM node found with id " + data.id));
        }
    }
);


virtDOM.render(virt.createView(HelloWorld), document.getElementById("app"));
</div>

          <h1>Web Worker Example</h1>

          <p>
            When using a WebWorker the view processing is handled in the worker while
            the main thread only responses to render calls and updates the DOM.
          </p>

          <h3>Web Worker Script</h3>
<div class="ace-editor code javascript">var virt = require("@nathanfaucett/virt"),
virtDOM = require("@nathanfaucett/virt-dom/src/worker/server");


virtDOM.render(virt.createView("p", "Hello, world!"));
</div>

          <h3>Main thread</h3>
<div class="ace-editor code javascript">var virtDOM = require("@nathanfaucett/virt-dom/src/worker/client");


virtDOM.createRenderer(
    "path-to-worker-script.js",
    document.getElementById("app")
);
</div>

          <h1>WebSocket Example</h1>

          <p>
            When using WebSockets the main thread only responses to render calls and updates the DOM.
          </p>

          <h3>Server</h3>
<div class="ace-editor code javascript">var virt = require("@nathanfaucett/virt"),
    virtDOM = require("@nathanfaucett/virt-dom/src/websocket/server"),
    socket_io = require("socket.io");


var io = socket_io(),
    root = null;


io.on("connection", function(socket) {
    virtDOM.render(
        virt.createView(virt.createView("p", "Hello, world!")),
        socket,
        function attachMessage(socket, callback) {
            socket.on("client-message", callback);
        },
        function sendMessage(socket, data) {
            socket.emit("server-message", data);
        }
    );
});

console.log("listening on port 9999");
io.listen(9999);
</div>

          <h3>Client</h3>
<div class="ace-editor code javascript">var io = require("socket.io-client"),
    virtDOM = require("@nathanfaucett/virt-dom/src/websocket/client");


var socket = io("localhost:9999");


socket.on("connect", function onConnect() {
    virtDOM.createRenderer(
        document.getElementById("app"),
        socket,
        function attachMessage(socket, callback) {
            socket.on("server-message", callback);
        },
        function sendMessage(socket, data) {
            socket.emit("client-message", data);
        }
    );
});

socket.on("error", function(error) {
    console.log(error);
});
</div>
      </section>
    </div>

    <p>&nbsp;</p>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">
          <a href="https://github.com/nathanfaucett/js-virt-dom" target="_blank">virt-dom</a> maintained by
          <a href="https://github.com/nathanfaucett">nathanfaucett</a>
        </p>
      </footer>
    </div>

  </body>
</html>
